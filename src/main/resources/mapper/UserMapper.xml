<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xodud1202.springbackend.mapper.UserMapper">
	<select id="getAdminUserList" resultType="com.xodud1202.springbackend.domain.admin.user.UserManageVO">
		/* UserMapper.getAdminUserList : 관리자 사용자 목록 조회 */
		SELECT UB.USR_NO
		     , UB.LOGIN_ID
		     , UB.USER_NM
		     , UB.USR_GRADE_CD
		     , UB.usr_stat_cd AS USR_STAT_CD
		     , UB.H_PHONE_NO
		     , UB.EMAIL
		     , DATE_FORMAT(UB.ACCESS_DT, '%Y-%m-%d %H:%i:%s') AS ACCESS_DT
		     , UB.LOGIN_FAIL_CNT
		     , DATE_FORMAT(UB.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT
		  FROM USER_BASE UB
		 WHERE 1 = 1
		<if test="usrStatCd != null and usrStatCd != ''">
		   AND UB.usr_stat_cd = #{usrStatCd}
		</if>
		<if test="usrGradeCd != null and usrGradeCd != ''">
		   AND UB.USR_GRADE_CD = #{usrGradeCd}
		</if>
		<if test="searchValue != null and searchValue != ''">
			<choose>
				<when test="searchGb == 'loginId'">
		   AND UB.LOGIN_ID LIKE CONCAT(#{searchValue}, '%')
				</when>
				<when test="searchGb == 'userNm'">
		   AND UB.USER_NM LIKE CONCAT(#{searchValue}, '%')
				</when>
			</choose>
		</if>
		 ORDER BY UB.USR_NO DESC
	</select>

	<select id="countAdminUserByLoginId" resultType="int">
		/* UserMapper.countAdminUserByLoginId : 관리자 사용자 로그인아이디 중복 건수 조회 */
		SELECT COUNT(1)
		  FROM USER_BASE
		 WHERE LOGIN_ID = #{loginId}
	</select>

	<select id="getAdminUserDetail" resultType="com.xodud1202.springbackend.domain.admin.user.UserManageVO">
		/* UserMapper.getAdminUserDetail : 관리자 사용자 단건 조회 */
		SELECT UB.USR_NO
		     , UB.LOGIN_ID
		     , UB.USER_NM
		     , UB.USR_GRADE_CD
		     , UB.usr_stat_cd AS USR_STAT_CD
		     , UB.H_PHONE_NO
		     , UB.EMAIL
		     , DATE_FORMAT(UB.ACCESS_DT, '%Y-%m-%d %H:%i:%s') AS ACCESS_DT
		     , UB.LOGIN_FAIL_CNT
		     , DATE_FORMAT(UB.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT
		  FROM USER_BASE UB
		 WHERE UB.USR_NO = #{usrNo}
	</select>

	<insert id="insertAdminUser">
		/* UserMapper.insertAdminUser : 관리자 사용자 등록 */
		INSERT INTO USER_BASE (
		       LOGIN_ID
		     , PWD
		     , USER_NM
		     , USR_GRADE_CD
		     , usr_stat_cd
		     , H_PHONE_NO
		     , EMAIL
		     , LOGIN_FAIL_CNT
		     , COMPANY_ROLE_NO
		     , REG_NO
		     , REG_DT
		     , udt_no
		     , UDT_DT
		) VALUES (
		       #{loginId}
		     , #{pwd}
		     , #{userNm}
		     , #{usrGradeCd}
		     , #{usrStatCd}
		     , #{hPhoneNo}
		     , #{email}
		     , 0
		     , 0
		     , #{regNo}
		     , NOW()
		     , #{udtNo}
		     , NOW()
		)
	</insert>

	<update id="updateAdminUser">
		/* UserMapper.updateAdminUser : 관리자 사용자 수정 */
		UPDATE USER_BASE
		<set>
			<if test="pwd != null and pwd != ''">
		     PWD = #{pwd},
			</if>
		     LOGIN_ID = #{loginId},
		     USER_NM = #{userNm},
		     USR_GRADE_CD = #{usrGradeCd},
		     usr_stat_cd = #{usrStatCd},
		     H_PHONE_NO = #{hPhoneNo},
		     EMAIL = #{email},
		     udt_no = #{udtNo},
		     UDT_DT = NOW()
		</set>
		 WHERE USR_NO = #{usrNo}
	</update>
</mapper>
