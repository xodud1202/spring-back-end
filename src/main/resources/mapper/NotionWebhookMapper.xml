<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xodud1202.springbackend.mapper.NotionWebhookMapper">
	<insert id="insertNotionWebhookTempBatch">
		/* NotionWebhookMapper.insertNotionWebhookTempBatch : Notion 웹훅 원문 임시 저장 */
		INSERT INTO KEY_VALUE_TEMP_TABLE (
		       REQUEST_URL
		     , TEMP_KEY
		     , TEMP_VALUE
		) VALUES
		<foreach collection="rows" item="row" separator=",">
			(
				   #{row.requestUrl}
				 , #{row.tempKey}
				 , #{row.tempValue}
			)
		</foreach>
	</insert>

	<insert id="upsertNotionDataList">
		/* NotionWebhookMapper.upsertNotionDataList : Notion 페이지 상세를 NOTION_DATA_LIST에 저장/수정 */
		INSERT INTO NOTION_DATA_LIST (
		       ID
		     , DATABASE_ID
		     , DATA_SOURCE_ID
		     , TITLE
		     , NOTES
		     , URL
		     , DEL_YN
		     , CATEGORY_ID
		     , CREATE_DT
		     , REG_DT
		     , UPT_DT
		) VALUES (
		       #{row.id}
		     , #{row.databaseId}
		     , #{row.dataSourceId}
		     , #{row.title}
		     , #{row.notes}
		     , #{row.url}
		     , #{row.delYn}
		     , #{row.categoryId}
		     , COALESCE(#{row.createDt}, NOW())
		     , NOW()
		     , NOW()
		)
		ON DUPLICATE KEY UPDATE
		       DATABASE_ID = VALUES(DATABASE_ID)
		     , DATA_SOURCE_ID = VALUES(DATA_SOURCE_ID)
		     , TITLE = VALUES(TITLE)
		     , NOTES = VALUES(NOTES)
		     , URL = VALUES(URL)
		     , DEL_YN = VALUES(DEL_YN)
		     , CATEGORY_ID = VALUES(CATEGORY_ID)
		     , CREATE_DT = VALUES(CREATE_DT)
		     , UPT_DT = NOW()
	</insert>
</mapper>
