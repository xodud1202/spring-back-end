<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xodud1202.springbackend.mapper.AdminNotionMapper">
	<select id="getAdminNotionSaveList" resultType="com.xodud1202.springbackend.domain.admin.notion.AdminNotionListRowVO">
		/* AdminNotionMapper.getAdminNotionSaveList : 관리자 Notion 저장 목록 조회 */
		SELECT NDL.ID
		     , NDL.CATEGORY_ID
		     , NC.CATEGORY_NM
		     , NDL.TITLE
		     , NDL.NOTES
		     , NDL.URL
		     , NDL.NOTION_URL
		     , DATE_FORMAT(NDL.CREATE_DT, '%Y-%m-%d %H:%i:%s') AS CREATE_DT
		  FROM NOTION_DATA_LIST NDL
		  LEFT JOIN NOTION_CATEGORY NC
		    ON NC.CATEGORY_ID = NDL.CATEGORY_ID
		 WHERE IFNULL(NDL.DEL_YN, 'N') = 'N'
		<if test="categoryId != null and categoryId != ''">
		   AND NDL.CATEGORY_ID = #{categoryId}
		</if>
		<if test="title != null and title != ''">
		   AND NDL.TITLE LIKE CONCAT('%', #{title}, '%')
		</if>
		<if test="createDtStart != null and createDtStart != ''">
		   AND NDL.CREATE_DT <![CDATA[>=]]> CONCAT(#{createDtStart}, ' 00:00:00')
		</if>
		<if test="createDtEnd != null and createDtEnd != ''">
		   AND NDL.CREATE_DT <![CDATA[<]]> DATE_ADD(CONCAT(#{createDtEnd}, ' 00:00:00'), INTERVAL 1 DAY)
		</if>
		 ORDER BY NDL.CREATE_DT DESC, NDL.ID DESC
		 LIMIT #{pageSize} OFFSET #{offset}
	</select>

	<select id="getAdminNotionSaveCount" resultType="int">
		/* AdminNotionMapper.getAdminNotionSaveCount : 관리자 Notion 저장 목록 건수 조회 */
		SELECT COUNT(1)
		  FROM NOTION_DATA_LIST NDL
		 WHERE IFNULL(NDL.DEL_YN, 'N') = 'N'
		<if test="categoryId != null and categoryId != ''">
		   AND NDL.CATEGORY_ID = #{categoryId}
		</if>
		<if test="title != null and title != ''">
		   AND NDL.TITLE LIKE CONCAT('%', #{title}, '%')
		</if>
		<if test="createDtStart != null and createDtStart != ''">
		   AND NDL.CREATE_DT <![CDATA[>=]]> CONCAT(#{createDtStart}, ' 00:00:00')
		</if>
		<if test="createDtEnd != null and createDtEnd != ''">
		   AND NDL.CREATE_DT <![CDATA[<]]> DATE_ADD(CONCAT(#{createDtEnd}, ' 00:00:00'), INTERVAL 1 DAY)
		</if>
	</select>

	<select id="getAdminNotionCategoryList" resultType="com.xodud1202.springbackend.domain.admin.notion.AdminNotionCategoryVO">
		/* AdminNotionMapper.getAdminNotionCategoryList : 관리자 Notion 카테고리 목록 조회 */
		SELECT CATEGORY_ID
		     , CATEGORY_NM
		     , COLOR
		     , SORT_SEQ
		     , DATE_FORMAT(REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT
		  FROM NOTION_CATEGORY
		 ORDER BY SORT_SEQ ASC, REG_DT ASC
	</select>

	<update id="updateAdminNotionCategorySortSeq">
		/* AdminNotionMapper.updateAdminNotionCategorySortSeq : 관리자 Notion 카테고리 정렬 순서 수정 */
		UPDATE NOTION_CATEGORY
		   SET SORT_SEQ = #{sortSeq}
		     , UPT_DT = NOW()
		 WHERE CATEGORY_ID = #{categoryId}
	</update>
</mapper>
